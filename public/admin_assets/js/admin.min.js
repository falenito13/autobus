$(document).ready(function() {
	$.each($("textarea[data-ckeditor=true]"), function(e, t) {
		CKEDITOR.replace($(this).attr("name"), {
			fullPage: !0,
			language: "ka",
			height: "400px"
		})
	})
});
var admin = {
		fields: {
			email: "#Email",
			password: "#Password",
			phone: "#Phone",
			message: "#Message"
		},
        clear: function(element) {
            $(element).parents('.col-md-2').remove();
        },
		logIn: function(e) {
			return _form.checkFields(e, function() {
				1 == _form.response.StatusCode ? location.href = $(e).data("success-url") : 2 == _form.response.StatusCode ? $(e).find(contact.fields.email).focus() : 3 == _form.response.StatusCode ? $(e).find(contact.fields.password).focus() : jAlert(_form.response.StatusMessage)
			}), !1
		},
        modalview: function(Id,Table) {
            $.ajax({
                type: 'GET',
                url: '/admin/viewitem/' + Id + '/' + Table,
                success: function(data) {
                    data.Locales.forEach(function(locale){
                        $('.edit-modal #Title-'+ locale).val(data.title[locale]);
                    });
                    $('.edit-modal  #PostTable').val(Table);
                    $('.edit-modal  #ID').val(data.id);
                    $('#Edit').modal('show');
                },
                error: function(data) {
                    console.log(data);
                }
            });
        },
		savePost: function(e, t) {
			return _form.checkFields(e, function() {
                console.log(_form.response.StatusCode);
			    if (_form.response.StatusCode === 1) {
                    swal({
                        title: "Good job!",
                        text: _form.response.StatusMessage,
                        type: "success",
                        confirmButtonColor: "#8CD4F5",
                        confirmButtonText: "Ok",
                        closeOnConfirm: true
                    }, function(){
                        window.location.replace($(e).data("success-url"));
                    });
                } else {
			        alert(_form.response.StatusMessage);
                }
			}), !1
		},
		changePostStatus: function(e, t, r) {
		    console.log(URL,LANG)
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            $.post(URL + LANG + "/admin/changestatus", {
                PostTable: t,
                ID: r
            }, function(d) {
                if (0 == (d = _form.parseJSON(d))) return !1;
                1 == d.StatusCode ? $(e).removeClass("green-status red-status").addClass(d.ItemStatusID == 1 ? "green-status" : "red-status") : swal(Lang.get('JsTrans.error_appeared'));
            })
		},
        changeSliderStatus: function(e, t, r) {
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            $.post(URL + LANG + "/admin/changesliderstatus", {
                PostTable: t,
                ID: r
            }, function(d) {
                console.log(_form.parseJSON(d));

                if (0 == (d = _form.parseJSON(d))) return !1;
                console.log(e);
                1 == d.StatusCode ? $(e).removeClass("green-status red-status").addClass(d.ItemStatusID == 1 ? "green-status" : "red-status") : swal(Lang.get('JsTrans.error_appeared'));
            })
        },
        refreshCalendar: function() {
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            $.get(URL + LANG + "/calendar", function(d) {
                if (0 == (d = _form.parseJSON(d))) return !1;
                1 == d.StatusCode ? swal(Lang.get('JsTrans.calendar_updated')) : swal(Lang.get('JsTrans.error_appeared'));
            })
        },
        changeMainStatus: function(e, t, r, s) {
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            $.post(URL + LANG + "/admin/changemainstatus/", {
                PostTable: t,
                ID: r,
                MaxMain: s
            }, function(d) {
                if (0 == (d = _form.parseJSON(d))) return !1;
                1 == d.StatusCode ? $(e).removeClass("green-status red-status").addClass(d.ItemStatusID == 1 ? "green-status" : "red-status") : swal(d.StatusMessage);
            })
        },
		deletePost: function(e, t, r) {
            swal({
                title: Lang.get('JsTrans.sure_to_delete'),
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: Lang.get('JsTrans.yes_delete'),
                cancelButtonText: Lang.get('JsTrans.no_delete'),
                closeOnConfirm: false,
                closeOnCancel: false
            }, function(isConfirm){
                if (isConfirm) {
                    $.ajaxSetup({
                        headers: {
                            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                        }
                    });
                    var locale = $('html[lang]').val();
                    $.post(URL + "/ka/admin/deletepost/" + r + "/" + t, {
                        PostTable: t,
                        ID: r
                    }, function(t) {
                        if (0 == (t = _form.parseJSON(t))) return !1;
                        if (1 == t.StatusCode) {
                            window.location.reload();
                            swal(Lang.get('JsTrans.delete'), Lang.get('JsTrans.item_deleted'), "success");
                        }
                    });
                } else {
                    swal(Lang.get('JsTrans.aborted'), Lang.get('JsTrans.delete_aborted'), "error");
                }
            });
		},
		saveContent: function(e) {
			return _form.checkFields(e), !1
		}
	},
	list = {
		new: function(e, t, k) {
                $('.add-modal #PostTable').val(e);
                $('.add-modal #ParentId').val(t);
                if (k != "NULL"){
                    $('.add-modal #TypeID').val(k);
                }
                $('#Add').modal('show');
		},
		view: function(Cat_id,PostTable) {
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            $.ajax({
                type: 'GET',
                url: '/admin/viewlistitem/' + Cat_id + '/' + PostTable,
                success: function(data) {
                    data.Locales.forEach(function(locale){
                        var Title = $.parseJSON(data.Data.title);
                        $('.edit-modal #Title-'+ locale).val(Title[locale]);
                    });
                    $('.edit-modal  #ParentId').val(data.Data.parent_id);
                    $('.edit-modal  #PostTable').val(data.PostTable);
                    $('.edit-modal  #ID').val(data.Data.cat_id);
                    $('.edit-modal  #Image').attr("src", "/images/"+data.Data.image);
                    $('#Edit').modal('show');
                },
                error: function(data) {
                    console.log(data);
                }
            });
		},
		add: function(formData,url) {

            $.ajax({
                url: url,
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (data)
                {
                    if ((data = _form.parseJSON(data)) === false) {
                        return false;
                    }
                    if ((data = _form.parseJSON(data)) === false) {
                        return false;
                    }
                    if (data.StatusCode === 1) {

                                $('li[data-id="' + data.parent_id + '"]').addClass("sub");
                                var string = `<li class="list-group-item " data-id="${data.ID}"><div class="list-wrapper">`+
                                        `<span class="title">${data.title}</span>`+
                                        `<div class="options clearfix right">`+
                                            `<span class="text-status red-status" data-toggle="tooltip" data-placement="top" title="Status" onclick="list.changeStatus(this, '${data.PostTable}', ${data.ID});" data-original-title="Status">`+
                                        `<i class="ti-eye"></i></span>`+
                                            `<span data-toggle="tooltip" data-placement="top" title="" class="shadow-inset" onclick="list.changeSortOrder(this, '${data.PostTable}', ${data.ID}, 0);" data-original-title="Up"><i class="ti-angle-up"></i></span>`+
                                        `<span data-toggle="tooltip" data-placement="top" title="" class="shadow-inset" onclick="list.changeSortOrder(this, '${data.PostTable}', ${data.ID}, 1);" data-original-title="Down"><i class="ti-angle-down"></i></span>`+
                                        (data.parent_id === "0" && data.PostTable === "categories" ?
                                            `<span  class="text-status green-status open-menu-modal" onclick="list.new('${data.PostTable}','${data.ID}');">`+
                                              `<i class="ti-plus" data-toggle="tooltip" data-placement="top" title="Add"></i>`+
                                        `</span>` : ``)+
                                        `<span class="text-dark-blue open-edit-modal" onclick="return list.view(${data.ID})"><i class="ti-pencil-alt" data-toggle="tooltip" data-placement="top" title="" data-original-title="Edit"></i></span>` +
                                        `<span class="text-status red-status" data-toggle="tooltip" data-placement="top" title="" onclick="list.delete(this, ${data.PostTable}, ${data.ID});" data-original-title="Delete">`+
                                              `<i class="ti-trash"></i></span></div></div><ul></ul></li>`;
                                $('li[data-id="' + data.parent_id + '"] > div + ul').append(string);
                                $('#Add').modal('hide');
                                    $.toast({
                                        heading: 'success',
                                        text: _form.response.StatusMessage,
                                        position: 'top-right',
                                        loaderBg: '#ff6849',
                                        icon: 'success',
                                        hideAfter: 2500,
                                        stack: 6
                                    });
                    }
                    if (data.StatusCode == 0) {
                        $.toast({
                            heading: Lang.get('JsTrans.error'),
                            text: data.StatusMessage,
                            position: 'top-right',
                            loaderBg: '#ff6849',
                            icon: 'danger',
                            hideAfter: 2500,
                            stack: 6
                        });
                        return false;
                    }else if (data.StatusCode == 3) {
                        $.each(data.StatusMessage, function(i) {
                            $.toast({
                                heading: Lang.get('JsTrans.error'),
                                text: data.StatusMessage[i],
                                position: 'top-right',
                                loaderBg: '#ff6849',
                                icon: 'danger',
                                hideAfter: 2500,
                                stack: 6
                            });
                        });

                        return false;
                    }
                },
                error: function(data) {
                    console.log(data);
                }
            });
		},
		edit: function(formData,url) {
            $.ajax({
                url: url,
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (data)
                {
                    if ((data = _form.parseJSON(data)) === false) {
                        return false;
                    }
                    if ((data = _form.parseJSON(data)) === false) {
                        return false;
                    }
                    if (data.StatusCode === 1) {
                        $('li[data-id="' + data.ID + '"] > div > span.title').text(data.title),
                            $('#Edit').modal('hide'),
                            $.toast({
                                heading: 'success',
                                text: data.StatusMessage,
                                position: 'top-right',
                                loaderBg: '#ff6849',
                                icon: 'success',
                                hideAfter: 2500,
                                stack: 6
                            });
                    }
                    if (data.StatusCode == 0) {
                        $.toast({
                            heading: Lang.get('JsTrans.error'),
                            text: data.StatusMessage,
                            position: 'top-right',
                            loaderBg: '#ff6849',
                            icon: 'danger',
                            hideAfter: 2500,
                            stack: 6
                        });
                        return false;
                    }else if (data.StatusCode == 3) {
                        $.each(data.StatusMessage, function(i) {
                            $.toast({
                                heading: Lang.get('JsTrans.error'),
                                text: data.StatusMessage[i],
                                position: 'top-right',
                                loaderBg: '#ff6849',
                                icon: 'danger',
                                hideAfter: 2500,
                                stack: 6
                            });
                        });

                        return false;
                    }
                },
                error: function(data) {
                    console.log(data);
                }
            });
		},
		delete: function(e, t, r) {
                    swal({
                        title: Lang.get('JsTrans.sure_to_delete'),
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: Lang.get('JsTrans.yes_delete'),
                        cancelButtonText: Lang.get('JsTrans.no_delete'),
                        closeOnConfirm: false,
                        closeOnCancel: false
                    }, function(isConfirm){
                        if (isConfirm) {
                            $.ajaxSetup({
                                headers: {
                                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                                }
                            });
                            var locale = $('html[lang]').val();
                            $.post(URL + LANG + "/admin/deletelistitem/" + r +"/"+t, {
                                PostTable: t,
                                ID: r
                            }, function(t) {
                                if (0 == (t = _form.parseJSON(t))) return !1;
                                if (1 == t.StatusCode) {
                                    var r = $(e).parents("ul").first().parents("li").first();
                                    $(e).parents("li").first().remove(), r.length && !r.find("li").length && r.removeClass("sub");
                                    swal(Lang.get('JsTrans.delete'), Lang.get('JsTrans.item_deleted'), "success");
                                }
                            });
                        } else {
                            swal(Lang.get('JsTrans.aborted'), Lang.get('JsTrans.delete_aborted'), "error");
                        }
                    });
		},
		changeStatus: function(e, t, r) {
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
			$.post(URL + LANG + "/admin/changelistitemstatus/" + r +"/"+ t, {
				PostTable: t,
				ID: r
			}, function(d) {
			    console.log(_form.parseJSON(d));

				if (0 == (d = _form.parseJSON(d))) return !1;
                console.log(e);
				1 == d.StatusCode ? $(e).removeClass("green-status red-status").addClass(d.ItemStatusID == 1 ? "green-status" : "red-status") : swal(Lang.get('JsTrans.error_appeared'));
			})
		},
		changeSortOrder: function(e, t, r, s) {

			if ($(e).parents("ul").first().parents("li").first().find("ul:first > li").length <= 1 || 0 == s && !$(e).parents("li").first().prev().length || 1 == s && !$(e).parents("li").first().next().length) return !1;
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
			$.post(URL + LANG + "/admin/changelistitemsortorder/", {
				PostTable: t,
				ID: r,
				SortID: s
			}, function(t) {
				if ($(e).parent().removeLoader(), 0 == (t = _form.parseJSON(t))) return !1;
				1 == t.StatusCode ? (li = $(e).parents("li").first(), s ? li.next().after(li.clone()[0].outerHTML) : li.prev().before(li.clone()[0].outerHTML), li.remove(), $('li[data-id="' + r + '"] .options').removeLoader()) : alert("Error")
			})
		},

        changeTableSortOrder: function(e, t, r, s) {
		    console.log($('#myTable >tbody:first >tr').length);
            if ($('#myTable >tbody:first >tr').length <= 1 || 0 == s && !$(e).parents("tr").first().prev().length || 1 == s && !$(e).parents("tr").first().next().length) return false;
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            $.post(URL + LANG + "/admin/changetableitemsortorder", {
                PostTable: t,
                ID: r,
                SortID: s
            }, function(t) {
                if ($(e).parent().removeLoader(), 0 == (t = _form.parseJSON(t))) return !1;
                1 == t.StatusCode ? (li = $(e).parents("tr").first(), s ? li.next().after(li.clone()[0].outerHTML) : li.prev().before(li.clone()[0].outerHTML), li.remove(), $('tr[data-id="' + r + '"] .options').removeLoader()) : alert("Error")
            })
        }
	};


$('#RegionID').on('change', function() {
	var RegID = $(this).val();
	initOptions(RegID)
});

function initOptions(ID) {
	$("#VillageID > option").each(function() {
		$(this).data('region-id') == ID ? $(this).removeAttr("disabled") : $(this).attr("disabled", true);
	});
}
$('#Add').on('hidden.bs.modal', function () {
    $(this).find('form').trigger('reset');
});
